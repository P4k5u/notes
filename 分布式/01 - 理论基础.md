### 简介
分布式系统由一组为了完成共同任务而协调工作的计算机节点组成，通过网络进行通信。分布式系统能满足互联网对大数据存储、高并发和快响应的要求，采用了分而治之的思想。

可以使用廉价的普通机器进行独立运算。然后通过互相协助来完成网站业务，这样就可以完成单个计算机节点无法完成的计算和存储任务
### 主要特征
#### 高性能
因为大量请求被合理地分摊到各个节点，使每一台 Web 服务器的压力减小，并且多个请求可以使用多台机器处理，所以能处理更多的请求和数据，性能更高，解决了互联网系统的 3 个关键问题 —— 大数据、高并发和快响应
#### 高可用
在单机系统中，机械故障会造成网站不可用，但在分布式系统中，如果某个节点出现故障，系统会自动发现这个故障，不再向这个节点转发请求，系统仍旧可以工作。自动避开存在故障的节点，继续对外提供服务
#### 可伸缩性
当现有机器的性能不能满足业务的发展时，需要更多的机器提供服务。只要改造路由算法，就能够路由到新的机器，从而将更多的机器容纳到系统中，继续满足要求
#### 可维护性
如果设备当中有一台机器因某种原因不能对外提供服务，只需停止出现故障的节点，对其进行处理，然后重新上线即可
#### 灵活性
在需要更新系统时，只需在非高峰期，停用部分节点，将这些节点更新为最新版本，然后再通过路由算法将请求路由到更新后的节点，就可以在更新系统时不间断对外提供服务了

### 分布式的切分方法
使用分布式系统，就意味着需要将系统按照不同的维度（如业务、数据等）切分给各个不同节点的机器，因此需要对业务或数据进行合理切分，让多个机器节点能够相互协作，以满足业务功能的需要
#### 水平切分
水平切分就是将同一个系统部署到多台机器上![[Pasted image 20240304145503.png]]
每台服务器都有相同的应用，都能独立完成计算，互不相干
这样的切分有以下好处：
- 简单：只需实现路由算法， 将请求合理地分配到各个节点即可。目前常用的是 Nginx、Netflix Zuul 和 Spring Cloud Gateway
- 独立：每个节点都有完整的运算功能，不需要依赖其他节点
- 高可用
- 可伸缩

#### 垂直切分
随着业务的增加和深入，以及用户数的膨胀，单一业务也会随之变得异常复杂，有必要按照业务的维度进行拆分，将各个业务独立出来，单独开发和维护![[Pasted image 20240304145810.png]]
这样拆分的好处如下：
- 提高业务独立性
- 提高灵活性
- 提高可维护性
但是也有一些弊端：
- 增加系统之间的协作：系统之间往往需要协作完成任务，也就是说，系统之间是相互依赖的。如今流行的系统交互有 RPC（远程过程调用）、SOA（面向服务的架构）、REST 风格请求和消息机制
- 降低了可用性：系统之间存在依赖，所以任何一个系统出现问题都会影响其他系统
- 数据一致性难以保证：因为节点之间需要通信，而网络通信往往不可靠

#### 混合切分
混合切分就是将水平切分和垂直切分结合起来，如今服务架构大部分采用了这种分法![[Pasted image 20240304150423.png]]

### 面临的问题

### 衡量指标

- 透明性：指一个分布式系统对外来说如同一个单机系统，使用者不需要知道其内部的实现，只需要知道其参数、功能和返回结果即可
- 可伸缩性
- 可用性
- 可靠性
- 高性能
- 一致性

### 分布式理论

#### CAP
分布式系统的主要特点就是 一致性、可用性和分区容忍性：
- 一致性（Consistency）：保持所有节点在同一个时刻具有相同的、逻辑一致的数据
- 可用性（Availability）：保证每个请求不管成功还是失败都有响应
- 分区容忍性（Partition tolerance）：系统中任何的信息丢失或失败都不会影响系统的继续运作
针对这三个特点，Eric Brewer 教授在 2000 年提出了 CAP 原则，该原则指出，任何分布式系统都不能同时满足 3 个特点![[Pasted image 20240111164125.png]]
根据 CAP 原则，分布式系统只能满足 3 种情况
- CA：满足一致性和可用性的系统，在可扩展性上比较困难
- CP：满足一致性和分区容忍性的系统，通常性能不是很高
- AP：满足可用性和分区容忍性的系统，通常对一致性要求低一些，但性能会比较高

在现在的互联网中，可用性往往是第一位的，其次是性能。因为从客户的感知来说，可用和快速响应能够提供更好的体验。一致性可以通过其他手段来保证

微服务主要追求可用性和分区容忍性（AP），弱一致性（C）

#### BASE
在现实的业务中，金额和商品的库存数据是企业生存的核心数据，在分布式系统中保证这些数据的一致性，是分布式系统的核心任务之一。在不同的线程和机器之间保持数据的一致性是十分困难的，需要使用很多协议才能保证。
在 BASE 理论中，一致性又分为强一致性和弱一致性。CAP 的 C 是指强一致性
- 强一致性：当用户完成数据更新操作之后，任何后续线程或其他节点都能访问到最新值。但这样对性能做出较大的牺牲
- 弱一致性：当用户完成数据更新操作之后，并不能保证后续线程或其他节点马上访问到最新值，只能通过某种方法来保证最后的一致性

BASE 理论是 Dan Pritchett 发表的，核心思想是：即使分布式系统无法做到强一致性，也可以采用适当的方法达到最终一致性
- 基本可用（Basically Available）：在分布式系统中，最重要的需求就是保证基本可用，有响应结果返回，不可用时返回一个降级服务，给用户一个响应来避免长时间等待，这会给用户带来良好的体验
- 软状态（Soft state）：其意义在于允许系统存在中间状态。一般来说，系统之间的数据通信都会存在副本，而这些副本都会存在一定的延迟。用弱一致性来代替强一致性，这样的好处在于能提高系统的可用和性能
- 最终一致性（Eventual consistency）：是指系统中的所有数据副本经过一定时间后，最终能够达到一致的状态，保证数据的正确性

BASE 理论的核心内容就是放弃 强一致性 ，保证系统的可用性。建议让数据在一段时间内不一致，从而降低技术实现的复杂性，并提高系统的性能

