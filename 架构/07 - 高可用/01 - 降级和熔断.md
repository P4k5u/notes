### 为什么需要降级和熔断
**由于服务之间的依赖关系导致**
当用户请求 A、P、H、I 四个服务获取数据时，在正常流量下系统稳定运行，如果某天系统进来大量流量，其中服务 I 出现 CPU、内存占用过高等问题，结果导致服务 I 出现延迟、响应过慢，随着请求的持续增加，服务 I 承受不住压力导致内部错误或资源耗尽，一直不响应，那么依赖服务 I 的其它服务也会一直等待，导致请求推挤，然后慢慢扩散到所有微服务，引发雪崩效应![[Pasted image 20231108162113.png]]

### 基本的容错模式
- 主动超时：Http 请求主动设置一个超时时间，超时就直接返回，不会造成服务堆积
- 限流：限制最大并发数
- 熔断：当错误数超过阈值时快速失败，不调用后端服务，同时隔一定时间放几个请求去重试服务是否能正常调用，如果成功则关闭熔断状态，失败则继续快速失败，直接返回（重试就是弹性恢复的能力）
- 隔离：把每个依赖或调用的服务都隔离开来，防止级联失败引起整体服务不可用
- 降级：服务失败或异常后，返回指定的默认信息